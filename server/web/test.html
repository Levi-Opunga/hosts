<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hosts CLI - Professional Interface</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Updated to darker, more professional color scheme */
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-card: #151515;
            --accent-primary: #2563eb;
            --accent-secondary: #1e40af;
            --accent-subtle: #3b82f6;
            --accent-muted: #1d4ed8;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border-primary: rgba(37, 99, 235, 0.2);
            --border-secondary: rgba(37, 99, 235, 0.1);
            --shadow-primary: 0 0 20px rgba(37, 99, 235, 0.15);
            --shadow-subtle: 0 0 10px rgba(37, 99, 235, 0.1);
            --gradient-primary: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            --gradient-subtle: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(30, 64, 175, 0.05) 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Darker, more subtle matrix background effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.03) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(30, 64, 175, 0.02) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.01) 0%, transparent 50%);
            pointer-events: none;
            z-index: -2;
        }

        /* Added subtle matrix rain effect with darker colors */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                    linear-gradient(90deg, transparent 98%, rgba(37, 99, 235, 0.03) 100%),
                    linear-gradient(180deg, transparent 98%, rgba(37, 99, 235, 0.02) 100%);
            background-size: 50px 50px;
            animation: matrix-scroll 20s linear infinite;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }

        @keyframes matrix-scroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            background: rgba(21, 21, 21, 0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid var(--border-primary);
            box-shadow: var(--shadow-primary);
            position: relative;
            overflow: hidden;
        }

        /* More subtle scanning line effect */
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 1px;
            background: var(--gradient-primary);
            animation: scan 4s linear infinite;
            opacity: 0.6;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            font-family: 'Orbitron', monospace;
            font-size: 3em;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            /* Removed bright glow, made more professional */
            filter: drop-shadow(0 0 8px rgba(37, 99, 235, 0.3));
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .header-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            background: rgba(21, 21, 21, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-secondary);
            transition: all 0.3s ease;
            position: relative;
        }

        /* More subtle hover effects */
        .info-card:hover {
            border-color: var(--border-primary);
            box-shadow: var(--shadow-subtle);
            transform: translateY(-1px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(21, 21, 21, 0.9);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-secondary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        /* Subtle background effect on hover */
        .stat-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--gradient-subtle);
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .stat-card:hover::after {
            width: 150px;
            height: 150px;
        }

        .stat-card:hover {
            border-color: var(--border-primary);
            box-shadow: var(--shadow-subtle);
            transform: translateY(-2px);
        }

        .stat-number {
            font-family: 'Orbitron', monospace;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 1.1em;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            background: rgba(21, 21, 21, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-secondary);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-subtle);
        }

        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-primary);
            font-size: 18px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* More professional button hover effect */
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-subtle);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-primary);
        }

        .btn-secondary {
            background: rgba(21, 21, 21, 0.9);
            color: var(--text-primary);
            border: 1px solid var(--border-primary);
        }

        .btn-secondary:hover {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-subtle);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .filter-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 30px;
            background: rgba(21, 21, 21, 0.9);
            padding: 6px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-secondary);
        }

        .filter-tab {
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-muted);
            position: relative;
            font-size: 14px;
        }

        .filter-tab.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-subtle);
        }

        .filter-tab:not(.active):hover {
            color: var(--accent-primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            background: rgba(21, 21, 21, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            border: 1px solid var(--border-primary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-secondary);
            border-top: 2px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .entries-container {
            background: rgba(21, 21, 21, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid var(--border-primary);
            min-height: 400px;
        }

        .entry {
            background: rgba(21, 21, 21, 0.9);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-secondary);
            transition: all 0.3s ease;
            position: relative;
        }

        .entry:hover {
            border-color: var(--border-primary);
            box-shadow: var(--shadow-subtle);
            transform: translateY(-1px);
        }

        .entry.disabled {
            opacity: 0.6;
            border-color: var(--border-secondary);
        }

        .entry.system {
            border-left: 3px solid #10b981;
        }

        .entry.comment {
            background: rgba(37, 99, 235, 0.03);
            border-color: var(--border-primary);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: rgba(21, 21, 21, 0.95);
            backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 0;
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-primary);
        }

        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-family: 'Orbitron', monospace;
            color: var(--accent-primary);
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: var(--text-muted);
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #ef4444;
        }

        .entry-fields {
            padding: 30px;
        }

        .field {
            margin-bottom: 25px;
        }

        .field label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .field input,
        .field textarea {
            width: 100%;
            padding: 15px;
            background: rgba(17, 17, 17, 0.9);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .field input:focus,
        .field textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-subtle);
        }

        .hostnames-input {
            min-height: 80px;
            resize: vertical;
        }

        .hostname-tag {
            display: inline-block;
            background: rgba(37, 99, 235, 0.15);
            color: var(--accent-primary);
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin: 2px;
            border: 1px solid var(--border-primary);
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(100, 116, 139, 0.3);
            transition: 0.3s;
            border-radius: 24px;
            border: 1px solid var(--border-secondary);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: var(--text-muted);
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: var(--accent-primary);
            box-shadow: var(--shadow-subtle);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
            background: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .controls {
                flex-direction: column;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1><i class="fas fa-network-wired"></i> HOSTS CLI</h1>
        <p>Advanced /etc/hosts file management with backup and validation</p>
        <div class="header-info">
            <div class="info-card">
                <strong><i class="fas fa-file"></i> File Path:</strong>
                <br>/etc/hosts
            </div>
            <div class="info-card">
                <strong><i class="fas fa-desktop"></i> System:</strong>
                <br>Linux - Version 5.4.0
            </div>
            <div class="info-card" id="lastModified">
                <strong><i class="fas fa-clock"></i> Last Modified:</strong>
                <br><span id="modifiedTime">2024-01-15 14:30:22</span>
            </div>
        </div>
    </div>

    <div class="stats" id="statsContainer">
        <div class="stat-card">
            <div class="stat-number" id="totalEntries">127</div>
            <div class="stat-label">Total Entries</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="activeEntries">89</div>
            <div class="stat-label">Active Entries</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="disabledEntries">23</div>
            <div class="stat-label">Disabled Entries</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="commentLines">15</div>
            <div class="stat-label">Comment Lines</div>
        </div>
    </div>

    <div class="controls">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search entries by IP, hostname, or comment...">
            <i class="fas fa-search"></i>
        </div>
        <button class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Entry
        </button>
        <button class="btn btn-secondary">
            <i class="fas fa-history"></i> Backups
        </button>
        <button class="btn btn-success">
            <i class="fas fa-save"></i> Save Changes
        </button>
        <button class="btn btn-secondary">
            <i class="fas fa-sync"></i> Reload
        </button>
    </div>

    <div class="filter-tabs">
        <div class="filter-tab active" data-filter="all">All</div>
        <div class="filter-tab" data-filter="active">Active</div>
        <div class="filter-tab" data-filter="disabled">Disabled</div>
        <div class="filter-tab" data-filter="system">System</div>
        <div class="filter-tab" data-filter="comments">Comments</div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Processing quantum data streams...</p>
    </div>

    <div class="entries-container">
        <div id="entriesContainer">
            <!-- Sample entries for demonstration -->
            <div class="entry system">
                <div class="entry-actions" style="position: absolute; top: 15px; right: 15px;">
                    <label class="toggle-switch" title="Enable/Disable">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                    <button class="btn btn-danger" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="entry-fields">
                    <div class="field">
                        <label>IP Address <i class="fas fa-shield-alt" title="System Entry"></i></label>
                        <input type="text" value="127.0.0.1">
                    </div>
                    <div class="field">
                        <label>Hostnames</label>
                        <textarea class="hostnames-input">localhost</textarea>
                        <div style="margin-top: 10px;">
                            <span class="hostname-tag">localhost</span>
                        </div>
                    </div>
                    <div class="field">
                        <label>Comment</label>
                        <input type="text" value="System loopback" placeholder="Optional comment">
                    </div>
                </div>
            </div>

            <div class="entry">
                <div class="entry-actions" style="position: absolute; top: 15px; right: 15px;">
                    <label class="toggle-switch" title="Enable/Disable">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                    <button class="btn btn-danger" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="entry-fields">
                    <div class="field">
                        <label>IP Address</label>
                        <input type="text" value="192.168.1.100">
                    </div>
                    <div class="field">
                        <label>Hostnames</label>
                        <textarea class="hostnames-input">dev.example.com api.example.com</textarea>
                        <div style="margin-top: 10px;">
                            <span class="hostname-tag">dev.example.com</span>
                            <span class="hostname-tag">api.example.com</span>
                        </div>
                    </div>
                    <div class="field">
                        <label>Comment</label>
                        <input type="text" value="Development servers" placeholder="Optional comment">
                    </div>
                </div>
            </div>

            <div class="entry disabled">
                <div class="entry-actions" style="position: absolute; top: 15px; right: 15px;">
                    <label class="toggle-switch" title="Enable/Disable">
                        <input type="checkbox">
                        <span class="slider"></span>
                    </label>
                    <button class="btn btn-danger" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="entry-fields">
                    <div class="field">
                        <label>IP Address</label>
                        <input type="text" value="0.0.0.0">
                    </div>
                    <div class="field">
                        <label>Hostnames</label>
                        <textarea class="hostnames-input">ads.google.com doubleclick.net</textarea>
                        <div style="margin-top: 10px;">
                            <span class="hostname-tag">ads.google.com</span>
                            <span class="hostname-tag">doubleclick.net</span>
                        </div>
                    </div>
                    <div class="field">
                        <label>Comment</label>
                        <input type="text" value="Block ads" placeholder="Optional comment">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Entry Modal -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-plus"></i> Add New Entry</h2>
            <span class="close">&times;</span>
        </div>
        <div class="entry-fields">
            <div class="field">
                <label>IP Address</label>
                <input type="text" id="newEntryIP" placeholder="192.168.1.1 or ::1">
            </div>
            <div class="field">
                <label>Hostnames</label>
                <textarea id="newEntryHostnames" placeholder="example.com www.example.com" class="hostnames-input"></textarea>
            </div>
            <div class="field">
                <label>Comment</label>
                <input type="text" id="newEntryComment" placeholder="Optional comment">
            </div>
            <div style="text-align: right; margin-top: 30px;">
                <button class="btn btn-secondary" style="margin-right: 10px;">Cancel</button>
                <button class="btn btn-primary">Add Entry</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Add some basic interactivity
    document.addEventListener('DOMContentLoaded', function() {
        // Filter tabs functionality
        const filterTabs = document.querySelectorAll('.filter-tab');
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                filterTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', function() {
            // Add search logic here
            console.log('Searching for:', this.value);
        });

        // Modal functionality
        const modal = document.getElementById('addModal');
        const closeBtn = document.querySelector('.close');

        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });

    class HostsManager {
        constructor() {
            this.entries = [];
            this.filteredEntries = [];
            this.currentFilter = 'all';
            this.searchTerm = '';
            this.backups = [];
            this.init();
        }

        init() {
            this.bindEvents();
            this.loadHosts(); // Load from API instead of sample data
            this.setupKeyboardShortcuts();
        }

        async loadHosts() {
            this.showLoading(true);
            try {
                const response = await fetch('/api/hosts');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                this.entries = data.entries || [];
                this.updateStats(data.stats);
                this.applyFilters();

                this.showNotification('Hosts file loaded successfully', 'success');
            } catch (error) {
                this.showNotification(`Failed to load hosts: ${error.message}`, 'error');
                this.entries = [];
                this.applyFilters();
            } finally {
                this.showLoading(false);
            }
        }

        updateStats(stats) {
            if (!stats) {
                // Calculate stats from entries if not provided
                this.updateStatsFromEntries();
                return;
            }

            document.getElementById('totalEntries').textContent = stats.totalEntries || 0;
            document.getElementById('activeEntries').textContent = stats.activeEntries || 0;
            document.getElementById('disabledEntries').textContent = stats.disabledEntries || 0;
            document.getElementById('commentLines').textContent = stats.commentLines || 0;
        }

        bindEvents() {
            // Filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    this.setFilter(e.target.dataset.filter);
                });
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', (e) => {
                this.setSearch(e.target.value);
            });

            // Control buttons
            document.querySelector('.controls .btn-primary').addEventListener('click', () => {
                this.showAddModal();
            });

            document.querySelector('.controls .btn-secondary').addEventListener('click', () => {
                this.showBackupsModal();
            });

            document.querySelector('.controls .btn-success').addEventListener('click', () => {
                this.saveHosts(); // Use API save method
            });

            document.querySelector('.controls .btn-secondary:last-of-type').addEventListener('click', () => {
                this.reloadHosts(); // Use API reload method
            });

            // Modal events
            this.setupModalEvents();
        }

        setupModalEvents() {
            const modal = document.getElementById('addModal');
            const closeBtn = modal.querySelector('.close');
            const cancelBtn = modal.querySelector('.btn-secondary');
            const addBtn = modal.querySelector('.btn-primary');

            closeBtn.addEventListener('click', () => this.hideModal('addModal'));
            cancelBtn.addEventListener('click', () => this.hideModal('addModal'));
            addBtn.addEventListener('click', () => this.addEntry());

            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    this.hideModal(e.target.id);
                }
            });
        }

        setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'n':
                            e.preventDefault();
                            this.showAddModal();
                            break;
                        case 's':
                            e.preventDefault();
                            this.saveHosts();
                            break;
                        case 'r':
                            e.preventDefault();
                            this.reloadHosts();
                            break;
                        case 'f':
                            e.preventDefault();
                            document.getElementById('searchInput').focus();
                            break;
                    }
                }
                if (e.key === 'Escape') {
                    this.hideAllModals();
                }
            });
        }

        toggleEntry(id, enabled) {
            const entry = this.entries.find(e => e.id === id);
            if (entry) {
                entry.disabled = !enabled; // Use 'disabled' property to match API
                this.applyFilters();
            }
        }

        updateEntry(id, field, value) {
            const entry = this.entries.find(e => e.id === id);
            if (!entry) return;

            if (field === 'hostnames') {
                entry.hostnames = value.trim().split(/\s+/).filter(h => h.length > 0);
            } else if (field === 'ip') {
                if (!this.validateIP(value)) {
                    this.showAlert('Invalid IP Address', 'Please enter a valid IPv4 or IPv6 address.');
                    return;
                }
                entry[field] = value;
            } else {
                entry[field] = value;
            }

            // Re-render to update hostname tags
            if (field === 'hostnames') {
                this.applyFilters();
            }
        }

        deleteEntry(id) {
            const entry = this.entries.find(e => e.id === id);
            if (entry && entry.isSystem) {
                this.showAlert('Cannot Delete', 'System entries cannot be deleted.');
                return;
            }

            this.showConfirm(
                'Delete Entry',
                'Are you sure you want to delete this entry? This action cannot be undone.',
                () => {
                    this.entries = this.entries.filter(e => e.id !== id);
                    this.applyFilters();
                    this.updateStatsFromEntries();
                    this.showNotification('Entry deleted successfully', 'success');
                }
            );
        }

        addEntry() {
            const ip = document.getElementById('newEntryIP').value.trim();
            const hostnames = document.getElementById('newEntryHostnames').value.trim();
            const comment = document.getElementById('newEntryComment').value.trim();

            if (!ip || !hostnames) {
                this.showAlert('Missing Information', 'Please enter both IP address and hostnames.');
                return;
            }

            if (!this.validateIP(ip)) {
                this.showAlert('Invalid IP Address', 'Please enter a valid IPv4 or IPv6 address.');
                return;
            }

            const newId = this.entries.length > 0 ? Math.max(...this.entries.map(e => e.id), 0) + 1 : 1;
            const newEntry = {
                id: newId,
                ip: ip,
                hostnames: hostnames.split(/\s+/).filter(h => h.length > 0),
                comment: comment,
                disabled: false,
                isComment: false,
                isSystem: false
            };

            this.entries.push(newEntry);
            this.applyFilters();
            this.updateStatsFromEntries();
            this.hideModal('addModal');
            this.showNotification('Entry added successfully', 'success');
        }

        validateIP(ip) {
            const ipv4Regex = /^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::1$|^::$/;
            return ipv4Regex.test(ip) || ipv6Regex.test(ip);
        }

        async saveHosts() {
            this.showLoading(true);
            try {
                const response = await fetch('/api/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ entries: this.entries })
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                this.showNotification('Hosts file saved successfully!', 'success');
                document.getElementById('modifiedTime').textContent = new Date().toLocaleString();
            } catch (error) {
                this.showNotification(`Failed to save: ${error.message}`, 'error');
            } finally {
                this.showLoading(false);
            }
        }

        reloadHosts() {
            this.showConfirm(
                'Reload Entries',
                'This will discard any unsaved changes. Are you sure?',
                () => {
                    this.loadHosts();
                }
            );
        }

        async showBackupsModal() {
            try {
                const response = await fetch('/api/backups');
                if (!response.ok) throw new Error('Failed to load backups');

                const backups = await response.json();
                this.createBackupModal(backups);
            } catch (error) {
                this.showNotification(`Failed to load backups: ${error.message}`, 'error');
                this.createBackupModal([]);
            }
        }

        createBackupModal(backups = []) {
            const modal = document.createElement('div');
            modal.id = 'backupModal';
            modal.className = 'modal';
            modal.style.display = 'block';

            let backupListHTML;

            if (!backups || backups.length === 0) {
                backupListHTML = '<div class="no-backups" style="text-align: center; color: var(--text-muted); padding: 40px;">No backups found</div>';
            } else {
                backupListHTML = backups.map(backup => `
        <div class="backup-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(17, 17, 17, 0.5); border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border-secondary);">
          <div class="backup-info">
            <div class="backup-name" style="font-weight: 600; color: var(--text-primary);">${backup.name}</div>
            <div class="backup-meta" style="color: var(--text-muted); font-size: 0.9em;">
              ${this.formatDate(backup.modified)} â€¢ ${this.formatBytes(backup.size)}
            </div>
          </div>
          <button class="btn btn-primary" onclick="window.hostsManager.restoreBackup('${backup.name}')">
            <i class="fas fa-undo"></i> Restore
          </button>
        </div>
      `).join('');
            }

            modal.innerHTML = `
      <div class="modal-content">
        <div class="modal-header">
          <h2><i class="fas fa-history"></i> Backup Management</h2>
          <span class="close">&times;</span>
        </div>
        <div class="entry-fields">
          <div style="margin-bottom: 20px;">
            <button class="btn btn-primary" id="createBackup">
              <i class="fas fa-plus"></i> Create Backup
            </button>
          </div>
          <div id="backupList">
            ${backupListHTML}
          </div>
        </div>
      </div>
    `;

            document.body.appendChild(modal);

            // Bind events
            modal.querySelector('.close').addEventListener('click', () => {
                document.body.removeChild(modal);
            });

            modal.querySelector('#createBackup').addEventListener('click', () => {
                this.createBackup();
                document.body.removeChild(modal);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        async restoreBackup(filename) {
            this.showConfirm(
                'Restore Backup',
                `Restore backup "${filename}"? This will overwrite the current hosts file.`,
                async () => {
                    try {
                        const response = await fetch(`/api/restore?file=${encodeURIComponent(filename)}`, {
                            method: 'POST'
                        });

                        if (!response.ok) throw new Error('Failed to restore backup');

                        this.showNotification('Backup restored successfully!', 'success');
                        // Close backup modal if it exists
                        const backupModal = document.getElementById('backupModal');
                        if (backupModal) {
                            document.body.removeChild(backupModal);
                        }
                        this.loadHosts();
                    } catch (error) {
                        this.showNotification(`Failed to restore backup: ${error.message}`, 'error');
                    }
                }
            );
        }

        formatDate(dateString) {
            return new Date(dateString).toLocaleString();
        }

        formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        createBackup() {
            this.showNotification('Backup creation requested', 'info');
        }

        applyFilters() {
            this.filteredEntries = this.entries.filter(entry => {
                // Filter by type
                let typeMatch = true;
                switch(this.currentFilter) {
                    case 'active':
                        typeMatch = !entry.disabled;
                        break;
                    case 'disabled':
                        typeMatch = entry.disabled;
                        break;
                    case 'system':
                        typeMatch = entry.isSystem;
                        break;
                    case 'comments':
                        typeMatch = entry.isComment || (entry.comment && entry.comment.trim() !== '');
                        break;
                }

                // Filter by search term
                let searchMatch = true;
                if (this.searchTerm) {
                    searchMatch = entry.ip.toLowerCase().includes(this.searchTerm) ||
                        entry.hostnames.some(h => h.toLowerCase().includes(this.searchTerm)) ||
                        (entry.comment && entry.comment.toLowerCase().includes(this.searchTerm));
                }

                return typeMatch && searchMatch;
            });

            this.renderEntries();
            this.updateStatsFromEntries();
        }

        createEntryElement(entry) {
            const div = document.createElement('div');
            div.className = `entry ${entry.isSystem ? 'system' : ''} ${entry.disabled ? 'disabled' : ''} ${entry.isComment ? 'comment' : ''}`;
            div.dataset.id = entry.id;

            if (entry.isComment) {
                div.innerHTML = `
        <div class="entry-actions" style="position: absolute; top: 15px; right: 15px;">
          <button class="btn btn-danger" title="Delete" style="padding: 8px 12px;">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <div class="entry-fields">
          <div class="field">
            <label>Comment Line</label>
            <input type="text" value="${entry.raw || ''}" placeholder="Comment text">
          </div>
        </div>
      `;

                // Bind events for comment entries
                const deleteBtn = div.querySelector('.btn-danger');
                const commentInput = div.querySelector('input[type="text"]');

                deleteBtn.addEventListener('click', () => {
                    this.deleteEntry(entry.id);
                });

                commentInput.addEventListener('blur', () => {
                    this.updateEntry(entry.id, 'raw', commentInput.value);
                });

                return div;
            }

            const hostnamesTags = (entry.hostnames || []).map(h =>
                `<span class="hostname-tag">${h}</span>`
            ).join('');

            div.innerHTML = `
      <div class="entry-actions" style="position: absolute; top: 15px; right: 15px;">
        <label class="toggle-switch" title="Enable/Disable">
          <input type="checkbox" ${!entry.disabled ? 'checked' : ''}>
          <span class="slider"></span>
        </label>
        <button class="btn btn-danger" title="Delete" style="padding: 8px 12px; margin-left: 10px;">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      <div class="entry-fields">
        <div class="field">
          <label>IP Address ${entry.isSystem ? '<i class="fas fa-shield-alt" title="System Entry"></i>' : ''}</label>
          <input type="text" value="${entry.ip}" ${entry.isSystem ? 'readonly' : ''}>
        </div>
        <div class="field">
          <label>Hostnames</label>
          <textarea class="hostnames-input" ${entry.isSystem ? 'readonly' : ''}>${(entry.hostnames || []).join(' ')}</textarea>
          <div style="margin-top: 10px;">
            ${hostnamesTags}
          </div>
        </div>
        <div class="field">
          <label>Comment</label>
          <input type="text" value="${entry.comment || ''}" placeholder="Optional comment" ${entry.isSystem ? 'readonly' : ''}>
        </div>
      </div>
    `;

            // Bind events
            const toggle = div.querySelector('.toggle-switch input');
            const deleteBtn = div.querySelector('.btn-danger');
            const ipInput = div.querySelector('input[type="text"]');
            const hostnamesInput = div.querySelector('textarea');
            const commentInput = div.querySelector('.field:last-child input');

            toggle.addEventListener('change', () => {
                this.toggleEntry(entry.id, toggle.checked);
            });

            deleteBtn.addEventListener('click', () => {
                this.deleteEntry(entry.id);
            });

            if (!entry.isSystem) {
                ipInput.addEventListener('blur', () => {
                    this.updateEntry(entry.id, 'ip', ipInput.value);
                });

                hostnamesInput.addEventListener('blur', () => {
                    this.updateEntry(entry.id, 'hostnames', hostnamesInput.value);
                });

                commentInput.addEventListener('blur', () => {
                    this.updateEntry(entry.id, 'comment', commentInput.value);
                });
            }

            return div;
        }

        updateStatsFromEntries() {
            const stats = {
                totalEntries: 0,
                activeEntries: 0,
                disabledEntries: 0,
                commentLines: 0
            };

            this.entries.forEach(entry => {
                if (entry.isComment) {
                    stats.commentLines++;
                } else {
                    stats.totalEntries++;
                    if (entry.disabled) {
                        stats.disabledEntries++;
                    } else {
                        stats.activeEntries++;
                    }
                }
            });

            this.updateStats(stats);
        }

        setFilter(filter) {
            this.currentFilter = filter;
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });
            this.applyFilters();
        }

        setSearch(term) {
            this.searchTerm = term.toLowerCase();
            this.applyFilters();
        }

        renderEntries() {
            const container = document.getElementById('entriesContainer');
            container.innerHTML = '';

            if (this.filteredEntries.length === 0) {
                container.innerHTML = `
        <div style="text-align: center; padding: 50px; color: var(--text-muted);">
          <i class="fas fa-search" style="font-size: 3em; margin-bottom: 20px; opacity: 0.3;"></i>
          <p>No entries found matching your criteria</p>
        </div>
      `;
                return;
            }

            this.filteredEntries.forEach(entry => {
                const entryEl = this.createEntryElement(entry);
                container.appendChild(entryEl);
            });
        }

        showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        showAddModal() {
            this.showModal('addModal');
            // Clear form fields
            document.getElementById('newEntryIP').value = '';
            document.getElementById('newEntryHostnames').value = '';
            document.getElementById('newEntryComment').value = '';
        }

        hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        hideAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Custom modal dialogs instead of browser prompts
        showAlert(title, message) {
            this.createCustomModal('alert', title, message);
        }

        showConfirm(title, message, onConfirm) {
            this.createCustomModal('confirm', title, message, onConfirm);
        }

        showPrompt(title, message, defaultValue, onConfirm) {
            this.createCustomModal('prompt', title, message, onConfirm, defaultValue);
        }

        createCustomModal(type, title, message, onConfirm, defaultValue = '') {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.style.zIndex = '1001';

            let content = `
      <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
          <h2><i class="fas fa-${type === 'alert' ? 'exclamation-triangle' : type === 'confirm' ? 'question-circle' : 'edit'}"></i> ${title}</h2>
        </div>
        <div class="entry-fields">
          <p style="margin-bottom: 20px; color: var(--text-secondary);">${message}</p>
    `;

            if (type === 'prompt') {
                content += `
        <div class="field">
          <input type="text" id="promptInput" value="${defaultValue}" style="margin-bottom: 20px;">
        </div>
      `;
            }

            content += `
          <div style="text-align: right;">
    `;

            if (type === 'confirm' || type === 'prompt') {
                content += `<button class="btn btn-secondary" style="margin-right: 10px;">Cancel</button>`;
            }

            content += `
            <button class="btn btn-primary">${type === 'alert' ? 'OK' : 'Confirm'}</button>
          </div>
        </div>
      </div>
    `;

            modal.innerHTML = content;
            document.body.appendChild(modal);

            const confirmBtn = modal.querySelector('.btn-primary');
            const cancelBtn = modal.querySelector('.btn-secondary');

            confirmBtn.addEventListener('click', () => {
                if (type === 'prompt' && onConfirm) {
                    const value = modal.querySelector('#promptInput').value;
                    onConfirm(value);
                } else if (onConfirm) {
                    onConfirm();
                }
                document.body.removeChild(modal);
            });

            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
            }

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });

            // Focus input for prompt
            if (type === 'prompt') {
                setTimeout(() => {
                    modal.querySelector('#promptInput').focus();
                }, 100);
            }
        }

        showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(21, 21, 21, 0.95);
      backdrop-filter: blur(20px);
      color: var(--text-primary);
      padding: 15px 20px;
      border-radius: 8px;
      border: 1px solid var(--border-primary);
      box-shadow: var(--shadow-primary);
      z-index: 1002;
      max-width: 300px;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    `;

            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';
            const color = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : 'var(--accent-primary)';

            notification.innerHTML = `
      <div style="display: flex; align-items: center;">
        <i class="fas fa-${icon}" style="color: ${color}; margin-right: 10px;"></i>
        <span>${message}</span>
      </div>
    `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[v0] Initializing Hosts Manager...');
        window.hostsManager = new HostsManager();
        console.log('[v0] Hosts Manager initialized successfully');
    });
</script>

</body>
</html>
